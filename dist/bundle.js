/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";function t(t,e){return Math.floor(Math.random()*(e-t+1))+t}function e(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}var n={x:35,y:315,width:160,height:80,vy:0,gravity:.3,jumpPower:-17};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function s(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}function o(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function c(t){var e=["denis_runner.png","coin.png","pothole.png","service.png","check_engine.png","inspector.png","quadro.png","quadro1.png","game_over_screen.webp","Valera_runner.png","danya.png","Cortage1.png","Cortage2.png","Cortage3.png","Cortage4.png","Cortage5.png","Cortage6.png","Cortage7.png","Cortage8.png","bg_sky.png","bg_road.png"],n=["loader.mp3","start.mp3","inspector_sfx.mp3","service.mp3","Check_Sound.mp3","death_sfx.mp3","valera.mp3","danya.mp3","cortage.mp3","bgMusic.mp3"],i=e.length+n.length,r=0,a=e.map((function(e){return new Promise((function(n){var a=new Image;a.src="assets/".concat(e),a.onload=function(){r++,t&&t(r/i),n({name:e,img:a})}}))})),s=n.map((function(e){return new Promise((function(n){var a=new Audio("assets/".concat(e));a.addEventListener("canplaythrough",(function(){r++,t&&t(r/i),n({name:e,audio:a})}),{once:!0})}))}));return Promise.all([].concat(o(a),o(s))).then((function(t){var e={},n={};return t.forEach((function(t){t.img&&(e[t.name]=t.img),t.audio&&(n[t.name]=t.audio)})),{images:e,audios:n}}))}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(){l=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function h(t,e,n,i){return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i})}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function c(e,n,i,r){var a=n&&n.prototype instanceof g?n:g,s=Object.create(a.prototype);return h(s,"_invoke",function(e,n,i){var r=1;return function(a,s){if(3===r)throw Error("Generator is already running");if(4===r){if("throw"===a)throw s;return{value:t,done:!0}}for(i.method=a,i.arg=s;;){var o=i.delegate;if(o){var h=E(o,i);if(h){if(h===f)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(1===r)throw r=4,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=3;var c=d(e,n,i);if("normal"===c.type){if(r=i.done?4:2,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=4,i.method="throw",i.arg=c.arg)}}}(e,i,new I(r||[])),!0),s}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f={};function g(){}function y(){}function v(){}var p={};h(p,a,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(O([])));w&&w!==n&&i.call(w,a)&&(p=w);var x=v.prototype=g.prototype=Object.create(p);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(r,a,s,o){var h=d(t[r],t,a);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==u(l)&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,s,o)}),(function(t){n("throw",t,s,o)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,o)}))}o(h.arg)}var r;h(this,"_invoke",(function(t,i){function a(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(a,a):a()}),!0)}function E(e,n){var i=n.method,r=e.i[i];if(r===t)return n.delegate=null,"throw"===i&&e.i.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var a=d(r,e.i,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var s=a.arg;return s?s.done?(n[e.r]=s.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function k(t){this.tryEntries.push(t)}function C(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function I(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function O(e){if(null!=e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(u(e)+" is not iterable")}return y.prototype=v,h(x,"constructor",v),h(v,"constructor",y),y.displayName=h(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,h(t,o,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},b(S.prototype),h(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var s=new S(c(t,n,i,r),a);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},b(x),h(x,o,"Generator"),h(x,a,(function(){return this})),h(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.unshift(i);return function t(){for(;n.length;)if((i=n.pop())in e)return t.value=i,t.done=!1,t;return t.done=!0,t}},e.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(t){s.type="throw",s.arg=e,n.next=t}for(var r=n.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a[4],o=this.prev,h=a[1],c=a[2];if(-1===a[0])return i("end"),!1;if(!h&&!c)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=o){if(o<h)return this.method="next",this.arg=t,i(h),!0;if(o<c)return i(c),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i[0]>-1&&i[0]<=this.prev&&this.prev<i[2]){var r=i;break}}r&&("break"===t||"continue"===t)&&r[0]<=e&&e<=r[2]&&(r=null);var a=r?r[4]:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r[2],f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),C(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var i=n[4];if("throw"===i.type){var r=i.arg;C(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={i:O(e),r:n,n:i},"next"===this.method&&(this.arg=t),f}},e}function d(t,e,n,i,r,a,s){try{var o=t[a](s),h=o.value}catch(t){return void n(t)}o.done?e(h):Promise.resolve(h).then(i,r)}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function g(t,e,n){return(e=v(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,v(i.key),i)}}function v(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var p=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners={}},e=[{key:"on",value:function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}},{key:"off",value:function(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((function(t){return t!==e})))}},{key:"emit",value:function(t,e){var n=this.listeners[t];if(n){var i,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){h=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(h)throw s}}}}(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;try{s(e)}catch(e){console.error("Error in handler for ".concat(t,":"),e)}}}catch(t){a.e(t)}finally{a.f()}}}}],e&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()),m=function(){return i=function t(e){var i=e.canvas,r=e.uiCanvas;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=i,this.uiCanvas=r,this.ctx=i.getContext("2d"),this.uiCtx=r.getContext("2d");var a=window.devicePixelRatio||1,s=this.canvas.getBoundingClientRect();this.canvas.width=s.width*a,this.canvas.height=s.height*a,this.uiCanvas.width=this.canvas.width,this.uiCanvas.height=this.canvas.height,this.ctx.scale(a,a),this.uiCtx.scale(a,a),this.isGameOver=!1,this.countdownActive=!1,this.frameCount=0,this.gameStarted=!1,this.allowMovement=!0,this.speed=.005,this.distanceSinceLastValera=0,this.distanceSinceLastDanya=0,this.distanceSinceLastCortage=0,this.nextCortageDistance=15e3,this.nextValeraDistance=7500,this.nextDanyaDistance=7500,this.distanceSinceLastPit=0,this.distanceSinceLastSpawn=0,this.minSpawnDistance=300,this.minDistanceBetweenSpawns=800,this.distanceTravelledPx=0,this.lastMilestoneMeters=0,this.lastCoinSpawnMeters=0,this.skyX1=0,this.skyX2=this.canvas.width,this.roadX1=0,this.roadX2=this.canvas.width,this.gravity=.5,this.groundY=this.canvas.height-100,this.valeras=[],this.danyas=[],this.cortage=[],this.obstacles=[],this.coins=[],this.inspectors=[],this.services=[],this.checks=[],this.quadros=[],this.runner=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n),this.runner.x=100,this.runner.y=this.groundY,this.runner.vy=0,this.runner.width=this.runner.imgWidth,this.runner.height=this.runner.imgHeight,this.runner.tiltAngle=0,this.runner.jumpStage=0},r=[{key:"update",value:function(){var n=this;if(this.allowMovement){var i,r,a,s;this.gameStarted&&(a=(r=(i=this).images["pothole.png"]).width,s=r.height,i.obstacles.push({img:r,x:i.canvas.width,y:i.groundY,width:a,height:s}),function(t){var e=t.images["coin.png"],n=e.width,i=e.height;t.coins.push({img:e,x:t.canvas.width,y:t.groundY-50,width:n,height:i})}(this),function(t){var e=t.images["Valera_runner.png"],n=e.width,i=e.height;t.valeras.push({img:e,x:t.canvas.width,y:t.groundY,width:n,height:i})}(this),function(t){var e=t.images["danya.png"],n=e.width,i=e.height;t.danyas.push({img:e,x:t.canvas.width,y:t.groundY,width:n,height:i})}(this),function(t){var e=t.images["Cortage1.png"],n=e.width,i=e.height;t.cortage.push({img:e,x:t.canvas.width,y:t.groundY-i,width:n,height:i,audioPlayed:!1})}(this),this.speed+=2e-5,this.distanceSinceLastValera+=this.speed,this.distanceSinceLastDanya+=this.speed,this.distanceSinceLastCortage+=this.speed,0===this.valeras.length&&0===this.danyas.length&&0===this.cortage.length&&(this.distanceSinceLastCortage>=this.nextCortageDistance?(this.spawnCortage(),this.distanceSinceLastCortage=0,this.nextCortageDistance=t(1e4,2e4)):this.distanceSinceLastValera>=this.nextValeraDistance?(this.spawnValera(),this.distanceSinceLastValera=0,this.nextValeraDistance=t(5e3,1e4)):this.distanceSinceLastDanya>=this.nextDanyaDistance&&(this.spawnDanya(),this.distanceSinceLastDanya=0,this.nextDanyaDistance=t(5e3,1e4))),this.cortage.forEach((function(t,e){0===e&&!t.audioPlayed&&t.x-n.runner.x<=500&&(n.cortageSfx.currentTime=0,n.cortageSfx.play().catch((function(){})),t.audioPlayed=!0),t.x-=1.32*n.speed})),this.cortage.length>0&&this.cortage[this.cortage.length-1].x+this.cortage[this.cortage.length-1].width<0&&(this.cortage=[]),this.valeras.forEach((function(t,i){var r,a;t.x-=1.1*n.speed,e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},t)&&(n.valeras.splice(i,1),n.isGameOver=!0,null===(r=n.bgMusic)||void 0===r||r.pause(),null===(a=n.deathSfx)||void 0===a||a.play())})),this.valeras=this.valeras.filter((function(t){return t.x+t.width>0})),this.danyas.forEach((function(t,i){var r;t.x-=1.2*n.speed,e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},t)&&(n.danyas.splice(i,1),n.score+=100,n.eventBus.emit("coinCollected",{value:100}),null===(r=n.danyaSfx)||void 0===r||r.play())})),this.danyas=this.danyas.filter((function(t){return t.x+t.width>0}))),this.distanceSinceLastSpawn+=6,this.distanceTravelledPx+=this.speed;var o=this.distanceTravelledPx/(160/3);this.kilometers=o/1e3,o-this.lastMilestoneMeters>=500&&(this.coinCount+=50,this.lastMilestoneMeters+=500),this.frameCount++,this.skyX1-=.3*this.speed,this.skyX2-=.3*this.speed,this.skyX1<=-this.canvas.width&&(this.skyX1=this.skyX2+this.canvas.width),this.skyX2<=-this.canvas.width&&(this.skyX2=this.skyX1+this.canvas.width),this.roadX1-=this.speed,this.roadX2-=this.speed,this.roadX1<=-this.canvas.width&&(this.roadX1=this.roadX2+this.canvas.width),this.roadX2<=-this.canvas.width&&(this.roadX2=this.roadX1+this.canvas.width),this.runner.vy+=this.gravity,this.runner.y+=this.runner.vy;var h=0;this.runner.y>=this.groundY?(this.runner.y=this.groundY,this.runner.vy=0,this.runner.onGround=!0,this.runner.jumpStage=0,h=0):(this.runner.onGround=!1,1===this.runner.jumpStage?(h=-45,this.runner.vy>=0&&(this.runner.jumpStage=2)):2===this.runner.jumpStage?(h=0,this.runner.vy>0&&(this.runner.jumpStage=3)):3===this.runner.jumpStage&&(h=45)),this.runner.tiltAngle+=.1*(h-this.runner.tiltAngle),this.obstacles.forEach((function(t,i){t.x-=n.speed;var r,a={x:t.x+t.width/2-2.5,y:t.y+t.height/2-2.5,width:5,height:5};e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},a)&&(n.isGameOver=!0,null===(r=n.audios["death_sfx.mp3"])||void 0===r||r.pause(),n.audios["death_sfx.mp3"].currentTime=0,n.audios["death_sfx.mp3"].play())})),this.obstacles=this.obstacles.filter((function(t){return t.x+t.width>0})),this.coins.forEach((function(t,i){t.x-=n.speed,e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},t)&&(n.score+=25,n.eventBus.emit("coinCollected",{value:25}),n.coins.splice(i,1))})),this.coins=this.coins.filter((function(t){return t.x+t.width>0})),this.inspectors.forEach((function(t,i){t.x-=n.speed;var r,a,s,o={x:t.x,y:t.y+15,width:t.width,height:t.height};e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},o)&&(n.inspectors.splice(i,1),n.score>=50?(n.score-=50,n.totalInspectorPaid=(n.totalInspectorPaid||0)+50,n.eventBus.emit("payment",{type:"inspector",amount:50}),null===(r=n.inspectorSfx)||void 0===r||r.play()):(n.isGameOver=!0,null===(a=n.bgMusic)||void 0===a||a.pause(),null===(s=n.deathSfx)||void 0===s||s.play()))})),this.inspectors=this.inspectors.filter((function(t){return t.x+t.width>0})),this.services.forEach((function(t,i){t.x-=n.speed;var r,a,s,o={x:t.x+(t.hitboxOffsetX||0),y:t.y+(t.height-(t.hitboxHeight||t.height))/2,width:t.hitboxWidth||t.width,height:t.hitboxHeight||t.height};e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},o)&&(n.services.splice(i,1),n.score>=100?(n.score-=100,n.totalServicePaid=(n.totalServicePaid||0)+100,n.eventBus.emit("payment",{type:"service",amount:100}),null===(r=n.serviceSfx)||void 0===r||r.play()):(n.isGameOver=!0,null===(a=n.bgMusic)||void 0===a||a.pause(),null===(s=n.deathSfx)||void 0===s||s.play()))})),this.services=this.services.filter((function(t){return t.x+t.width>0})),this.checks.forEach((function(t,i){t.x-=n.speed;var r,a,s={x:t.x,y:t.y,width:t.width,height:t.height};e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},s)&&(n.checks.splice(i,1),n.isGameOver=!0,null===(r=n.bgMusic)||void 0===r||r.pause(),null===(a=n.checkSfx)||void 0===a||a.play())})),this.checks=this.checks.filter((function(t){return t.x+t.width>0})),this.quadros.forEach((function(t,i){!t.falling&&e({x:n.runner.x,y:n.runner.y,width:n.runner.width,height:n.runner.height},{x:t.x-10,y:t.y-10,width:t.width+20,height:t.height+20})&&(t.falling=!0,t.vyFall=(n.groundY-t.y)/18,n.eventBus.emit("coinCollected",{value:50})),t.falling&&(t.y+=t.vyFall)})),this.quadros=this.quadros.filter((function(t){return t.y+t.height<n.groundY}))}}},{key:"draw",value:function(){if(this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.uiCtx.imageSmoothingEnabled=!0,this.uiCtx.imageSmoothingQuality="high",this.isGameOver)p.emit("renderGameOver");else{if(this.countdownActive)return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.uiCtx.clearRect(0,0,this.uiCanvas.width,this.uiCanvas.height),this.ctx.drawImage(this.skyImg,0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.denisImg,this.runner.x,this.runner.y,this.runner.width,this.runner.height),this.uiCtx.fillStyle="white",this.uiCtx.textAlign="center",this.uiCtx.font="72px Arial",this.uiCtx.fillText(this.countdown,this.canvas.width/2,this.canvas.height/2),void requestAnimationFrame(this.draw.bind(this));this.canvas.style.filter="none",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.uiCtx.clearRect(0,0,this.uiCanvas.width,this.uiCanvas.height),this.ctx.textAlign="start",this.gameStarted&&this.update();var t=this.roadImg.height/this.roadImg.width,e=this.canvas.width*t;e*=.9;var n=.1*(this.canvas.height-(this.canvas.height-e)),i=this.canvas.height-e+n,r=this.skyImg.height/this.skyImg.width,a=this.canvas.width,s=a*r,o=i-s;this.ctx.drawImage(this.skyImg,0,0,this.skyImg.width,this.skyImg.height,this.skyX1,o,a,s),this.ctx.drawImage(this.skyImg,0,0,this.skyImg.width,this.skyImg.height,this.skyX2,o,a,s),this.ctx.drawImage(this.roadImg,0,0,this.roadImg.width,this.roadImg.height,this.roadX1,i,this.canvas.width,e),this.ctx.drawImage(this.roadImg,0,0,this.roadImg.width,this.roadImg.height,this.roadX2,i,this.canvas.width,e),this.ctx.save(),this.ctx.translate(this.runner.x+this.runner.width/2,this.runner.y+this.runner.height/2),this.ctx.rotate(this.runner.tiltAngle*Math.PI/180),this.ctx.drawImage(this.denisImg,-this.runner.width/2,-this.runner.height/2,this.runner.width,this.runner.height),this.ctx.restore(),this.drawEntities(),requestAnimationFrame(this.draw.bind(this))}}},{key:"start",value:(a=l().mark((function t(){var e,n,i,r,a,s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=document.getElementById("loaderOverlay"),n=document.getElementById("loaderBar"),i=document.getElementById("loaderText"),t.next=5,c((function(t){var e=Math.floor(100*t);n&&(n.style.width="".concat(e,"%")),i&&(i.innerText="Loading... ".concat(e,"%"))}));case 5:r=t.sent,a=r.images,s=r.audios,this.images=a,this.audios=s,this.denisImg=a["denis_runner.png"],this.skyImg=a["bg_sky.png"],this.roadImg=a["bg_road.png"],this.groundY=this.canvas.height-this.roadImg.height,this.cortageSfx=s["cortage.mp3"],this.valeraSfx=s["valera.mp3"],this.danyaSfx=s["danya.mp3"],this.serviceSfx=s["service.mp3"],this.inspectorSfx=s["inspector_sfx.mp3"],this.checkSfx=s["Check_Sound.mp3"],this.deathSfx=s["death_sfx.mp3"],this.bgMusic=s["bgMusic.mp3"],e&&(e.style.display="none"),this.gameStarted=!0,window.addEventListener("keydown",(function(t){"Space"===t.code&&p.emit("jump"),"Enter"===t.code&&p.emit("restart")})),this.canvas.addEventListener("mousedown",(function(){p.emit("jump")})),this.canvas.addEventListener("touchstart",(function(){p.emit("jump")})),this.draw();case 26:case"end":return t.stop()}}),t,this)})),s=function(){var t=this,e=arguments;return new Promise((function(n,i){var r=a.apply(t,e);function s(t){d(r,n,i,s,o,"next",t)}function o(t){d(r,n,i,s,o,"throw",t)}s(void 0)}))},function(){return s.apply(this,arguments)})},{key:"drawEntities",value:function(){var t=this.ctx,e=function(e){return e.forEach((function(e){return t.drawImage(e.img,e.x,e.y,e.width,e.height)}))};e(this.obstacles),e(this.coins),e(this.inspectors),e(this.services),e(this.checks),e(this.quadros),e(this.valeras),e(this.danyas),e(this.cortage)}}],r&&y(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,r,a,s}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,b(i.key),i)}}function b(t){var e=function(t){if("object"!=w(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}var S=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bindEvents()},(e=[{key:"bindEvents",value:function(){p.on("gameOver",(function(t){var e=t.score,n=t.bestScore,i=t.totalServicePaid,r=t.totalInspectorPaid,a=document.getElementById("gameOverScreen");if(a){a.style.display="block";var s=document.getElementById("goScore"),o=document.getElementById("goBest"),h=document.getElementById("goPayments");s&&(s.innerText="Ваш счет: ".concat(e)),o&&(o.innerText="BEST: ".concat(n));var c=[];i>0&&c.push('В сервисе заплатили: <span style="color:red">-'.concat(i,"</span>")),r>0&&c.push('Капустникам заплатили: <span style="color:red">-'.concat(r,"</span>")),h&&(h.innerHTML=c.join(" "))}})),p.on("renderGameOver",(function(){})),p.on("coinCollected",(function(t){var e=t.coin,n=document.getElementById("scoreDisplay");n&&(n.innerText="Score: ".concat(e.value))}))}}])&&x(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("gameCanvas"),e=document.getElementById("uiCanvas");if(t&&e){var n=new m({canvas:t,uiCanvas:e}),i=(new S,document.getElementById("startOverlay")),r=document.getElementById("startButton");r&&r.addEventListener("click",a),window.addEventListener("keydown",(function(t){"Enter"===t.code&&a()}))}else console.error('Canvas elements not found. Ensure <canvas id="gameCanvas"> and <canvas id="uiCanvas"> exist.');function a(){i&&(i.style.display="none"),n.start()}}))})();